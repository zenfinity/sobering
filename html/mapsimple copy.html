<!DOCTYPE html>
<html>

<head>
  <title>mapsimple copy</title>
  <!-- <link rel="stylesheet" href="../css/styles.css"> -->
  <style>
    .map {
      margin: 0px;
      /* overflow: hidden; */
      
    }

    div.map {
        border-style: solid;
        border-color:aquamarine;
    }

    svg.map {
        border-style:dotted;
        border-color: crimson;
    }

    .sphere {
      fill: rgba(224, 255, 255, 0.4);
    }

    .country {
      fill: darkgrey;
      stroke: whitesmoke;
      stroke-width: 0.05px;
      opacity: .75;
    }

    .country:hover {
      /* fill: gray; */
      stroke: gray;
      stroke-width: 1px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>
</head>

<body>

  <div class="map">
    <svg class="map" id="mapInteractive" width="960" height="480"></svg>
    <button id="reset">Reset Zoom</button><br />
  </div>

  <!-- <script src="../js/map2.js"></script> -->
  <script>
    ///////////////////////////

    const svg = d3.select('#mapInteractive');
    const width = svg.attr("width");
    const height = svg.attr("height");

    const projection = d3.geoGuyou()
      .scale(200)
      .translate([width / 2.2, height / 1.5]);

    const pathGenerator = d3.geoPath().projection(projection);


    const g = svg.append('g');

    g.append('path')
      .attr('class', 'sphere')
      .attr('d', pathGenerator({ type: 'Sphere' }));

    //_________________Zoom
    const zoom = d3.zoom()
      .extent([[0, 0], [width, height]])
      .scaleExtent([1, 8])
      .translateExtent([[-100, -100], [width + 90, height + 100]])
      .on("zoom", zoomed);

    svg.call(zoom)

    function zoomed({ transform }) {
      g.attr("transform", transform);
    }

    function reset() {
      svg.transition()
        .duration(750)
        .call(zoom.transform, d3.zoomIdentity);
    }

    d3.select("#reset")
      .on("click", reset)



    Promise.all([
      d3.tsv('https://unpkg.com/world-atlas@1.1.4/world/110m.tsv'),
      d3.json('https://unpkg.com/world-atlas@1.1.4/world/110m.json')
    ]).then(([tsvData, topoJSONdata]) => {

      // const countryName = tsvData.reduce((accumulator, d) => {
      //     accumulator[d.iso_n3] = d.name;
      //     return accumulator;
      // }, {});


      const countryName = {};
      tsvData.forEach(d => {
        countryName[d.iso_n3] = d.name;
      });


      const countries = topojson.feature(topoJSONdata, topoJSONdata.objects.countries);
      g.selectAll('path').data(countries.features)
        .enter().append('path')
        .attr('class', 'country')
        .attr('d', pathGenerator)
        .append('title')
        .text(d => countryName[d.id]);

    });


  </script>
</body>

</html>